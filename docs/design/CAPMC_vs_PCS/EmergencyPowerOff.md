# Elimination of Formal "Emergency Power Off" as a Software Feature from 'Cray Managment Software'

Shasta CAPMC had a feature known as Emergency Power Off (EPO).  The EPO was a: software driven, fast, forced, shutdown, of all descendants of the selected list of xnames. After the emergency_power_off operation had completed, the selected xnames and all of their descendants would be in an Off state.

'EPO' was only supported for Olympus hardware. The underlying mechanism for implementation is a redfish 'EPO' endpoint on the chassis BMC. When the 'EPO' endpoint is targeted it causes a power off to the chassis which cascades automatically to all other chassis in the cooling group (cooling groups are between two and six cabinets), resulting in numerous chassis (and all components below the chassis level) being taken offline. 

EPO as a CAPMC feature is not correctly named.  EPO is a hardware connotation; it is a failure mode from control theory.  CAPMC's 'EPO' is not a 'legitimate' EPO because it does not have the automatic feedback mechanisms or automatic remediation (some action to counteract the negative state).  CAPMC's EPO has a non autonomous actor in the loop, which means at the very least the feature is misnamed.  

The hardware (Olympus and River) has legitmitate emegency power off built into it.  In the Olympus case an over voltage, over temperature, or coolant leak will all cause the system to power down the effected cooling group.   All commoditiy processors have over temperature protections that prevent the hardware from getting too hot; this has been a standard feature for decades. River hardware, as commodity hardware, does not cascade EPO across components, e.g. an overtemp on a River NCN will not cascade to powering off some larger swath of hardware in the system.

Calling CAPMC's EPO feature 'emergency power off' is potentially "harmful". It gives the wrong impression of the capability. It implies a level of control and automation that we cannot accomplish at the CMS (Cray Management Systems) level. Furthermore, performing fast, forced, shutdown of hardware can damage hardware (optical connectors, spinning disks, etc).  This type of quick power off is used by the hardware as a tradeoff when the risk of greater damagage is present. Manual deployment of this type of power off is not adviseable.  This is a bit 'ontological' but as an analogy we wouldnt allow human drivers to deploy airbags manually in cars, regardless of intent for several reasons: 1) the risk to occupants in a non-kinetic situation is too high to allow someone to deploy an airbag. 2) drivers cannot react better than the car.  This analogy holds quite well for comparing against our systems. 

In reviewing the customer SOW's we could not find any explicit requirement for a software EPO.  There are of course requirements that the hardware have appropriate protections to protect itself (which are satisfied, to our knowledge).

We interviewed long time system administrators about the CAPMC EPO functionality to understand how they would/had leveraged it.  One admin commented that "over the last 30 years they never needed to do an EPO; they were never at the console when bad things happen." Another long time system administrator said "If a human is in the loop is not a big enough emergency." In discussing this with several administrators the feeling we got was that an explicit software EPO would never be used for a few reasons:

1. detection - the admins were not likely to be standing exactly where the problem was to see it. This is especially relevant given the large physical footprint of our systems and that our management can be done 'remotely'.
2. response - if hypothetically they could see the problem they were sure the hardware would power things off before they got the chance to.   (They had experienced hardware EPOs before, they had never needed or gotten to use software 'EPO')
3. duplicate tooling - CAPMC today can forcefully turn off all of the components of the system. A separate EPO endpoint wasn't needed because they could use xname_off.
4. risk of damage - forcing an artificial 'EPO' is a big hammer to swing. All the safeguards are off. They would be hard-pressed to find a case where they had a scenario so urgent that it was worth the risk of an EPO vs a normal shutdown and in which the system hardware wouldn't have already intervened. 

## Recommendation
PCS will retain the core feature of being able to gracefully and forcefully shutdown the system.  We will not expose a separate API endpoint for the forceful shutdown path (software EPO) based on our conversations with administrators, readings of requirements and because the functionality is duplicated.   PCS CLI will have the ability to accept a `--all-computes`, `--all-non-management`, etc options to the transitions command that will help the user quickly transition those xnames to off. 